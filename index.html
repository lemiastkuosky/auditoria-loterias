<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auditoria Master v8.1 | Lets 3D</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --bg: #0b0b0b; --surface: #161616; --surface-2: #222; --border: #333; 
            --text: #e0e0e0; --dim: #888; --accent: #00e5ff;
            --money: #00c853; --warn: #ffab00; --danger: #ff5252;
            --milhar: #2979ff; --centena: #ab47bc;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
        
        .container { max-width: 1600px; margin: 0 auto; padding: 20px; width: 100%; padding-bottom: 100px; }
        
        /* CABEÇALHO RESTAURADO */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 25px; }
        .header h1 { font-size: 16px; letter-spacing: 2px; text-transform: uppercase; color: var(--accent); margin: 0; }
        #clock { font-family: 'JetBrains Mono'; color: var(--dim); font-size: 12px; font-weight: 700; }

        /* CARDS GLOBAIS (AJUSTADOS) */
        .global-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
        .g-card { background: var(--surface); border: 1px solid var(--border); padding: 15px; border-radius: 6px; border-left: 4px solid var(--border); }
        .g-card.c-hoje { border-left-color: var(--accent); }
        .g-card.c-sem { border-left-color: var(--money); }
        .g-card.c-mes { border-left-color: var(--warn); }
        
        .g-label { font-size: 9px; text-transform: uppercase; color: var(--dim); font-weight: 700; display: block; margin-bottom: 5px; }
        .g-value { font-family: 'JetBrains Mono'; font-size: 18px; font-weight: 700; color: #fff; }
        
        /* LAYOUT DIVIDIDO */
        .dashboard-split { display: grid; grid-template-columns: 350px 1fr; gap: 20px; align-items: start; }
        
        .sidebar { display: flex; flex-direction: column; gap: 20px; }
        .filter-box { background: var(--surface); border: 1px solid var(--border); padding: 15px; border-radius: 6px; }
        .f-group { margin-bottom: 12px; }
        .f-label { font-size: 10px; font-weight: 700; color: var(--dim); margin-bottom: 5px; display: block; }
        
        select, input, button { background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; font-size: 12px; border-radius: 4px; width: 100%; outline: none; }
        button { background: var(--surface-2); cursor: pointer; font-weight: 700; text-transform: uppercase; font-size: 10px; }
        button:hover { background: var(--accent); color: #000; }

        /* MATRIZ AGRUPADA */
        .matrix-box { background: var(--surface); border: 1px solid var(--border); border-radius: 6px; overflow: hidden; }
        .matrix-header { background: var(--surface-2); padding: 12px; font-size: 10px; font-weight: 700; text-transform: uppercase; border-bottom: 1px solid var(--border); }
        .matrix-table { width: 100%; border-collapse: collapse; }
        .matrix-table th { text-align: left; padding: 10px; font-size: 9px; color: var(--dim); border-bottom: 1px solid var(--border); }
        .matrix-table td { padding: 10px; font-size: 11px; border-bottom: 1px solid var(--border); font-family: 'JetBrains Mono'; }
        .mt-name { font-family: 'Inter'; font-weight: 700; color: #fff; }

        /* CONTEÚDO PRINCIPAL */
        .main-content { background: var(--surface); border: 1px solid var(--border); border-radius: 6px; overflow: hidden; }
        .content-header { padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .content-title { font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--dim); }

        .big-table-wrap { overflow-x: auto; }
        .big-table { width: 100%; border-collapse: collapse; text-align: left; min-width: 700px; }
        .big-table th { background: var(--surface-2); padding: 12px; font-size: 9px; color: var(--dim); text-transform: uppercase; border-bottom: 1px solid var(--border); }
        .big-table td { padding: 12px; border-bottom: 1px solid #222; font-size: 12px; }
        
        .cell-num { font-family: 'JetBrains Mono'; font-weight: 700; background: #000; padding: 3px 7px; border-radius: 4px; border: 1px solid var(--border); }
        .cell-val { font-family: 'JetBrains Mono'; font-weight: 700; color: var(--money); }
        .badge { padding: 3px 7px; border-radius: 4px; font-size: 9px; font-weight: 700; text-transform: uppercase; }
        .b-milhar { background: rgba(41, 121, 255, 0.1); color: var(--milhar); }
        .b-centena { background: rgba(171, 71, 188, 0.1); color: var(--centena); }

        /* RODAPÉ ESTILO CLÁSSICO */
        footer { 
            background: #050505; padding: 12px 20px; border-top: 1px solid var(--border); 
            display: flex; justify-content: space-between; align-items: center; 
            position: fixed; bottom: 0; left: 0; width: 100%; z-index: 100;
        }
        .status-group { display: flex; gap: 20px; }
        .status-item { display: flex; align-items: center; gap: 8px; font-size: 10px; font-weight: 700; color: var(--dim); }
        .led { width: 7px; height: 7px; border-radius: 50%; background: #333; }
        .led.active { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .status-label { color: var(--accent); }

        /* RESPONSIVIDADE CELULAR */
        @media (max-width: 900px) {
            .container { padding: 10px; }
            .header { flex-direction: column; gap: 10px; text-align: center; }
            .global-stats { grid-template-columns: 1fr 1fr; gap: 10px; }
            .dashboard-split { grid-template-columns: 1fr; }
            .sidebar { order: -1; } /* Filtros primeiro no celular */
            footer { flex-direction: column; gap: 10px; padding: 15px; }
            .status-group { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Dashboard Auditoria v8.1 | Lets 3D</h1>
        <div id="clock">--:--:--</div>
    </div>

    <div class="global-stats">
        <div class="g-card c-hoje">
            <span class="g-label">Hoje</span>
            <div class="g-value" id="totHoje">R$ 0,00</div>
        </div>
        <div class="g-card c-sem">
            <span class="g-label">7 Dias</span>
            <div class="g-value" id="totSemana">R$ 0,00</div>
        </div>
        <div class="g-card c-mes">
            <span class="g-label">Mês Atual</span>
            <div class="g-value" id="totMes">R$ 0,00</div>
        </div>
        <div class="g-card">
            <span class="g-label">Ticket Médio</span>
            <div class="g-value" id="totTicket">R$ 0,00</div>
        </div>
    </div>

    <div class="dashboard-split">
        <div class="sidebar">
            <div class="filter-box">
                <div class="f-group">
                    <span class="f-label">DATA BASE</span>
                    <input type="date" id="fData" onchange="renderizarTudo()">
                </div>
                <div class="f-group">
                    <span class="f-label">MODO DE VISÃO</span>
                    <select id="fAgrupar" onchange="renderizarTudo()">
                        <option value="sim">Agrupar por Banca (Ex: Nacional)</option>
                        <option value="nao">Mostrar Extrações Detalhadas</option>
                    </select>
                </div>
                <button onclick="carregarBanco()">Atualizar Banco</button>
            </div>

            <div class="matrix-box">
                <div class="matrix-header">Performance por Banca</div>
                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th>BANCA</th>
                            <th style="text-align:right">PREMIOS</th>
                            <th style="text-align:right">TOTAL</th>
                        </tr>
                    </thead>
                    <tbody id="corpoMatriz"></tbody>
                </table>
            </div>
        </div>

        <div class="main-content">
            <div class="content-header">
                <span class="content-title">Registros do Período</span>
                <span style="font-size:10px; color:var(--accent)" id="contador">0 registros</span>
            </div>
            <div class="big-table-wrap">
                <table class="big-table">
                    <thead>
                        <tr>
                            <th>Hora</th>
                            <th>Loteria</th>
                            <th>Mod</th>
                            <th>Número</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody id="corpoTabela"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<footer>
    <div class="status-group">
        <div class="status-item">
            <div id="lGit" class="led active"></div> GITHUB: <span class="status-label">ONLINE</span>
        </div>
        <div class="status-item">
            <div id="lSvr" class="led active"></div> API SERVIDOR: <span id="statusSvr" class="status-label">SINCRONIZADO</span>
        </div>
    </div>
    <div style="font-size: 10px; font-weight: 800; letter-spacing: 1px; color: var(--dim)">CRIADO POR LE | v8.1</div>
</footer>

<script>
    let bancoTotal = [];

    async function iniciar() {
        document.getElementById('fData').value = new Date().toISOString().split('T')[0];
        setInterval(() => { 
            document.getElementById('clock').innerText = new Date().toLocaleString('pt-BR'); 
        }, 1000);
        await carregarBanco();
        setInterval(carregarBanco, 300000); 
    }

    async function carregarBanco() {
        try {
            const r = await fetch('dados_loterias.json?v=' + Date.now());
            if(r.ok) {
                const t = await r.text();
                bancoTotal = t ? JSON.parse(t) : [];
                renderizarTudo();
            }
        } catch (e) { console.log(e); }
    }

    function renderizarTudo() {
        const dataF = document.getElementById('fData').value.split('-').reverse().join('/');
        const agrupar = document.getElementById('fAgrupar').value;

        // Filtro por data
        const filtrados = bancoTotal.filter(item => !document.getElementById('fData').value || item.dia === dataF);

        // Renderiza Tabela Principal
        const corpo = document.getElementById('corpoTabela');
        document.getElementById('contador').innerText = `${filtrados.length} registros`;
        
        corpo.innerHTML = filtrados.slice().reverse().map(i => {
            const mod = (i.modalidade || 'Geral').toUpperCase();
            const badge = mod.includes('MILHAR') ? 'b-milhar' : (mod.includes('CENTENA') ? 'b-centena' : '');
            return `
            <tr>
                <td style="color:var(--dim); font-family: 'JetBrains Mono'">${i.horario_extracao}</td>
                <td style="font-weight:700">${i.loteria}</td>
                <td><span class="badge ${badge}">${mod}</span></td>
                <td><span class="cell-num">${i.numero_sorteado || '---'}</span></td>
                <td class="cell-val">${i.valor}</td>
            </tr>`;
        }).join('') || '<tr><td colspan="5" style="text-align:center; padding:30px; color:#555">Nenhum dado para este dia</td></tr>';

        // Renderiza Matriz Agrupada
        renderizarMatriz(filtrados, agrupar);
        calcularGlobais();
    }

    function renderizarMatriz(dados, agrupar) {
        const resumo = {};
        
        dados.forEach(i => {
            let nome = i.loteria;
            if(agrupar === 'sim') {
                // Remove horários como "12HS", "15HS", etc para agrupar
                nome = nome.replace(/\s\d+HS/gi, '').trim();
            }
            const v = parseFloat(i.valor.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
            if(!resumo[nome]) resumo[nome] = { qtd: 0, total: 0 };
            resumo[nome].qtd++;
            resumo[nome].total += v;
        });

        document.getElementById('corpoMatriz').innerHTML = Object.keys(resumo).map(nome => `
            <tr>
                <td class="mt-name">${nome}</td>
                <td style="text-align:right">${resumo[nome].qtd}</td>
                <td style="text-align:right; color:var(--money)">${resumo[nome].total.toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}</td>
            </tr>
        `).join('');
    }

    function calcularGlobais() {
        const hoje = new Date().toLocaleDateString('pt-BR');
        let sHoje=0, sSem=0, sMes=0, qtd=0;

        bancoTotal.forEach(i => {
            const v = parseFloat(i.valor.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
            const partes = i.dia.split('/');
            const dItem = new Date(partes[2], partes[1]-1, partes[0]);
            
            if(i.dia === hoje) sHoje += v;
            if(dItem.getMonth() === new Date().getMonth()) sMes += v;
            if((new Date() - dItem)/(1000*60*60*24) <= 7) sSem += v;
            qtd++;
        });

        const fmt = {style:'currency', currency:'BRL'};
        document.getElementById('totHoje').innerText = sHoje.toLocaleString('pt-BR', fmt);
        document.getElementById('totSemana').innerText = sSem.toLocaleString('pt-BR', fmt);
        document.getElementById('totMes').innerText = sMes.toLocaleString('pt-BR', fmt);
        document.getElementById('totTicket').innerText = qtd ? (sMes/qtd).toLocaleString('pt-BR', fmt) : 'R$ 0,00';
    }

    iniciar();
</script>
</body>
</html>