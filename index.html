<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auditoria PRO v7.0 | AnÃ¡lise Detalhada</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --bg: #0d0d0d; --surface: #1a1a1a; --border: #2a2a2a; 
            --accent: #d1d1d1; --text: #ffffff; --dim: #888; 
            --warn: #ff9800; --success: #4caf50; --danger: #f44336; 
            --milhar: #2196f3; --centena: #9c27b0;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; min-height: 100vh; }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; flex: 1; width: 100%; padding-bottom: 90px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 20px; }
        .header h1 { font-size: 16px; letter-spacing: 2px; text-transform: uppercase; color: var(--accent); margin: 0; }
        
        /* PAINEL FINANCEIRO (Cards Escuros) */
        .summary-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; background: #333; border: 1px solid #333; border-radius: 6px; overflow: hidden; margin-bottom: 20px; }
        .sum-item { background: #111; text-align: center; padding: 15px; }
        .sum-item h3 { font-size: 9px; color: #888; margin: 0 0 5px 0; letter-spacing: 1px; }
        .sum-item p { font-size: 16px; color: #fff; margin: 0; font-family: 'JetBrains Mono'; font-weight: 700; }
        .sum-item.highlight p { color: var(--success); }

        /* RELATÃ“RIO POR EXTRAÃ‡ÃƒO (Novo Bloco) */
        .report-box { background: #151515; border: 1px solid var(--border); border-radius: 4px; padding: 15px; margin-bottom: 25px; }
        .report-title { font-size: 11px; font-weight: 700; color: var(--accent); margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid #222; padding-bottom: 5px; display: flex; justify-content: space-between; }
        .report-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; }
        .report-item { background: #0a0a0a; border: 1px solid #222; padding: 10px; border-radius: 3px; display: flex; justify-content: space-between; align-items: center; }
        .report-info { display: flex; flex-direction: column; }
        .r-name { font-size: 11px; font-weight: 700; color: #fff; }
        .r-time { font-size: 10px; color: var(--dim); font-family: 'JetBrains Mono'; }
        .r-val { font-family: 'JetBrains Mono'; font-size: 13px; color: var(--success); font-weight: 700; }

        /* TABELA */
        .table-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: 4px; overflow-x: auto; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; text-align: left; min-width: 800px; }
        th { background: #222; padding: 12px; font-size: 10px; color: var(--dim); text-transform: uppercase; border-bottom: 1px solid var(--border); white-space: nowrap; }
        td { padding: 12px; border-bottom: 1px solid var(--border); font-size: 12px; white-space: nowrap; vertical-align: middle; }
        
        .row-suspect { background: rgba(255, 152, 0, 0.05); border-left: 3px solid var(--warn); }
        
        /* Badges de Modalidade e NÃºmero */
        .badge { padding: 3px 6px; border-radius: 3px; font-size: 9px; font-weight: 700; text-transform: uppercase; }
        .bg-milhar { background: rgba(33, 150, 243, 0.15); color: var(--milhar); border: 1px solid rgba(33, 150, 243, 0.3); }
        .bg-centena { background: rgba(156, 39, 176, 0.15); color: var(--centena); border: 1px solid rgba(156, 39, 176, 0.3); }
        .bg-normal { background: #333; color: #ccc; }
        
        .num-destaque { font-family: 'JetBrains Mono'; font-size: 14px; font-weight: 700; letter-spacing: 1px; color: #fff; background: #000; padding: 4px 8px; border-radius: 4px; border: 1px solid #333; display: inline-block; min-width: 50px; text-align: center; }

        /* FILTROS E RODAPÃ‰ */
        .filters { background: var(--surface); border: 1px solid var(--border); padding: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px; align-items: flex-end; }
        select, input, button { background: #000; border: 1px solid var(--border); color: #fff; padding: 8px; font-size: 11px; border-radius: 3px; width: 100%; }
        button { cursor: pointer; background: #333; font-weight: 700; } button:hover { background: var(--accent); color: #000; }

        footer { background: #050505; padding: 8px 20px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: fixed; bottom: 0; left: 0; width: 100%; z-index: 100; box-shadow: 0 -4px 10px rgba(0,0,0,0.5); }
        .led { width: 6px; height: 6px; border-radius: 50%; background: #333; display: inline-block; margin-right: 5px; }
        .led.active { background: var(--success); box-shadow: 0 0 6px var(--success); }
        
        @media (max-width: 600px) {
            footer { flex-direction: column; gap: 5px; padding: 10px; }
            .summary-bar { grid-template-columns: 1fr 1fr; }
            .summary-bar .sum-item:last-child { grid-column: span 2; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Auditoria PRO v7.0 | Lets 3D</h1>
        <div id="clock" style="font-family: 'JetBrains Mono'; color: var(--dim); font-size: 11px;">--/--/-- 00:00</div>
    </div>

    <div class="summary-bar">
        <div class="sum-item"><h3>HOJE</h3><p id="resHoje">R$ 0,00</p></div>
        <div class="sum-item"><h3>7 DIAS</h3><p id="resSemana">R$ 0,00</p></div>
        <div class="sum-item highlight"><h3>MÃŠS ATUAL</h3><p id="resMes">R$ 0,00</p></div>
    </div>

    <div class="report-box">
        <div class="report-title">
            <span>ðŸ“š Consolidado por ExtraÃ§Ã£o (Dia Selecionado)</span>
            <span id="totalDia" style="color:#fff">R$ 0,00</span>
        </div>
        <div class="report-grid" id="gridRelatorio">
            </div>
    </div>

    <div class="filters">
        <div><label style="font-size:9px;color:#888;font-weight:700">DATA</label><input type="date" id="fData" onchange="processarDados()"></div>
        <div><label style="font-size:9px;color:#888;font-weight:700">EXTRAÃ‡ÃƒO</label><select id="fLoteria" onchange="processarDados()"><option value="">TODAS</option></select></div>
        <div><label style="font-size:9px;color:#888;font-weight:700">MODALIDADE</label><select id="fMod" onchange="processarDados()"><option value="">TODAS</option></select></div>
        <div><label>&nbsp;</label><button onclick="carregarBanco()">ATUALIZAR</button></div>
    </div>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Hora</th>
                    <th>ExtraÃ§Ã£o</th>
                    <th>Mod</th>
                    <th>NÃºmero</th>
                    <th>Ganhador</th>
                    <th>Valor</th>
                </tr>
            </thead>
            <tbody id="corpoTabela"></tbody>
        </table>
    </div>
</div>

<footer>
    <div style="font-size:9px;color:#888;font-weight:600"><span id="lSvr" class="led"></span> API: <span id="tSvr">...</span></div>
    <div style="font-size:9px;color:#888;font-weight:700">CRIADO POR LE | v7.0</div>
</footer>
<script>
    let bancoTotal = [];

    async function iniciar() {
        document.getElementById('fData').value = new Date().toISOString().split('T')[0];
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleString('pt-BR'); }, 1000);
        await carregarBanco();
        setInterval(carregarBanco, 300000); // 5 minutos
    }

    async function carregarBanco() {
        try {
            const r = await fetch('dados_loterias.json?v=' + Date.now());
            if(r.ok) {
                const t = await r.text();
                bancoTotal = t ? JSON.parse(t) : [];
                document.getElementById('lSvr').className = 'led active';
                document.getElementById('tSvr').innerText = 'ONLINE';
                povoarFiltros();
                processarDados();
            }
        } catch (e) { console.log(e); }
    }

    function povoarFiltros() {
        const selLot = document.getElementById('fLoteria');
        const selMod = document.getElementById('fMod');
        const loterias = [...new Set(bancoTotal.map(i => i.loteria))].sort();
        const mods = [...new Set(bancoTotal.map(i => i.modalidade || 'Outros'))].sort();
        
        if(selLot.options.length <= 1) loterias.forEach(l => selLot.add(new Option(l, l)));
        if(selMod.options.length <= 1) mods.forEach(m => selMod.add(new Option(m, m)));
    }

    function processarDados() {
        const dataF = document.getElementById('fData').value.split('-').reverse().join('/');
        const lotF = document.getElementById('fLoteria').value;
        const modF = document.getElementById('fMod').value;

        // Filtro Principal
        const filtrados = bancoTotal.filter(item => {
            const matchData = !document.getElementById('fData').value || item.dia === dataF;
            const matchLot = !lotF || item.loteria === lotF;
            const matchMod = !modF || (item.modalidade || 'Outros') === modF;
            return matchData && matchLot && matchMod;
        });

        renderizarTabela(filtrados);
        gerarRelatorioConsolidado(filtrados);
        calcularPainelFinanceiro();
    }

    function gerarRelatorioConsolidado(dados) {
        // Agrupa por Nome da Loteria para saber qual pagou mais no dia
        const resumo = {};
        let totalGeralDia = 0;

        dados.forEach(item => {
            const chave = item.loteria;
            const val = parseFloat(item.valor.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
            
            if(!resumo[chave]) resumo[chave] = { total: 0, qtd: 0 };
            resumo[chave].total += val;
            resumo[chave].qtd += 1;
            totalGeralDia += val;
        });

        const grid = document.getElementById('gridRelatorio');
        grid.innerHTML = Object.keys(resumo).map(k => {
            const r = resumo[k];
            return `
            <div class="report-item">
                <div class="report-info">
                    <span class="r-name">${k}</span>
                    <span class="r-time">${r.qtd} prÃªmio(s) hoje</span>
                </div>
                <div class="r-val">${r.total.toLocaleString('pt-BR', {style:'currency', currency:'BRL'})}</div>
            </div>`;
        }).join('') || '<div style="color:#666;font-size:11px;padding:10px">Nenhuma extraÃ§Ã£o registrada nesta data.</div>';

        document.getElementById('totalDia').innerText = totalGeralDia.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
    }

    function renderizarTabela(dados) {
        const corpo = document.getElementById('corpoTabela');
        corpo.innerHTML = dados.slice().reverse().map(i => {
            // Estilo da badge (Milhar Azul / Centena Roxa)
            const mod = i.modalidade ? i.modalidade.toUpperCase() : 'GERAL';
            let badgeClass = 'bg-normal';
            if(mod.includes('MILHAR')) badgeClass = 'bg-milhar';
            if(mod.includes('CENTENA')) badgeClass = 'bg-centena';
            
            // NÃºmero com destaque
            const numero = i.numero_sorteado || i.numero || '---';

            return `
                <tr class="${i.suspeito ? 'row-suspect' : ''}">
                    <td style="font-family:'JetBrains Mono'">${i.horario_extracao}</td>
                    <td><strong>${i.loteria}</strong></td>
                    <td><span class="badge ${badgeClass}">${mod}</span></td>
                    <td><span class="num-destaque">${numero}</span></td>
                    <td style="color:var(--dim)">${i.ganhador.substring(0,20)}</td>
                    <td style="color:var(--success);font-weight:700;font-family:'JetBrains Mono'">${i.valor}</td>
                </tr>
            `;
        }).join('') || '<tr><td colspan="6" style="padding:30px;text-align:center;color:#444">NADA ENCONTRADO</td></tr>';
    }

    function calcularPainelFinanceiro() {
        // CÃ¡lculo global (ignora filtro de data da tabela para somar mÃªs e semana)
        const hoje = new Date();
        const dataHoje = hoje.toLocaleDateString('pt-BR');
        let sHoje=0, sSemana=0, sMes=0;

        bancoTotal.forEach(i => {
            const v = parseFloat(i.valor.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
            const partes = i.dia.split('/');
            const dItem = new Date(partes[2], partes[1]-1, partes[0]);
            
            if(i.dia === dataHoje) sHoje += v;
            if(dItem.getMonth() === hoje.getMonth() && dItem.getFullYear() === hoje.getFullYear()) sMes += v;
            
            const diffDias = (hoje - dItem)/(1000*60*60*24);
            if(diffDias >= 0 && diffDias <= 7) sSemana += v;
        });

        const fmt = {style:'currency', currency:'BRL'};
        document.getElementById('resHoje').innerText = sHoje.toLocaleString('pt-BR', fmt);
        document.getElementById('resSemana').innerText = sSemana.toLocaleString('pt-BR', fmt);
        document.getElementById('resMes').innerText = sMes.toLocaleString('pt-BR', fmt);
    }

    iniciar();
</script>
</body>
</html>